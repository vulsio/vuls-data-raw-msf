{
  "name": "Exim4 string_format Function Heap Buffer Overflow",
  "fullname": "exploit/unix/smtp/exim4_string_format",
  "rank": 600,
  "disclosure_date": "2010-12-07",
  "type": "exploit",
  "author": [
    "jduck <jduck@metasploit.com>",
    "hdm <x@hdm.io>"
  ],
  "description": "This module exploits a heap buffer overflow within versions of Exim prior to\n        version 4.69. By sending a specially crafted message, an attacker can corrupt the\n        heap and execute arbitrary code with the privileges of the Exim daemon.\n\n        The root cause is that no check is made to ensure that the buffer is not full\n        prior to handling '%s' format specifiers within the 'string_vformat' function.\n        In order to trigger this issue, we get our message rejected by sending a message\n        that is too large. This will call into log_write to log rejection headers (which\n        is a default configuration setting). After filling the buffer, a long header\n        string is sent. In a successful attempt, it overwrites the ACL for the 'MAIL\n        FROM' command. By sending a second message, the string we sent will be evaluated\n        with 'expand_string' and arbitrary shell commands can be executed.\n\n        It is likely that this issue could also be exploited using other techniques such\n        as targeting in-band heap management structures, or perhaps even function pointers\n        stored in the heap. However, these techniques would likely be far more platform\n        specific, more complicated, and less reliable.\n\n        This bug was original found and reported in December 2008, but was not\n        properly handled as a security issue. Therefore, there was a 2 year lag time\n        between when the issue was fixed and when it was discovered being exploited\n        in the wild. At that point, the issue was assigned a CVE and began being\n        addressed by downstream vendors.\n\n        An additional vulnerability, CVE-2010-4345, was also used in the attack that\n        led to the discovery of danger of this bug. This bug allows a local user to\n        gain root privileges from the Exim user account. If the Perl interpreter is\n        found on the remote system, this module will automatically exploit the\n        secondary bug as well to get root.",
  "references": [
    "CVE-2010-4344",
    "CVE-2010-4345",
    "OSVDB-69685",
    "OSVDB-69860",
    "BID-45308",
    "BID-45341",
    "URL-https://seclists.org/oss-sec/2010/q4/311",
    "URL-http://www.gossamer-threads.com/lists/exim/dev/89477",
    "URL-http://bugs.exim.org/show_bug.cgi?id=787",
    "URL-http://git.exim.org/exim.git/commitdiff/24c929a27415c7cfc7126c47e4cad39acf3efa6b"
  ],
  "platform": "Unix",
  "arch": "cmd",
  "rport": 25,
  "autofilter_ports": [
    25,
    465,
    587,
    2525,
    25025,
    25000
  ],
  "autofilter_services": [
    "smtp",
    "smtps"
  ],
  "targets": [
    "Automatic"
  ],
  "mod_time": "2023-01-04 14:45:58 +0000",
  "path": "/modules/exploits/unix/smtp/exim4_string_format.rb",
  "is_install_path": true,
  "ref_name": "unix/smtp/exim4_string_format"
}
