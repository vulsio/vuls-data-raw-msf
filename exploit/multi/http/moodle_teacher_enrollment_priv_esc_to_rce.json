{
  "name": "Moodle Teacher Enrollment Privilege Escalation to RCE",
  "fullname": "exploit/multi/http/moodle_teacher_enrollment_priv_esc_to_rce",
  "rank": 400,
  "disclosure_date": "2020-07-20",
  "type": "exploit",
  "author": [
    "HoangKien1020",
    "lanz",
    "h00die"
  ],
  "description": "Moodle version 3.9, 3.8 to 3.8.3, 3.7 to 3.7.6, 3.5 to 3.5.12 and earlier unsupported versions\n          allow for a teacher to exploit chain to RCE.  A bug in the privileges system allows a teacher\n          to add themselves as a manager to their own class. They can then add any other users, and thus\n          look to add someone with manager privileges on the system (not just the class).  After\n          adding a system manager, a 'loginas' feature is used to access their account.  Next the system\n          is reconfigured to allow for all users to install an addon/plugin.  Then a malicious theme\n          is uploaded and creates an RCE.\n\n          If all of that is a success, we revert permissions for managers to system default and\n          remove our malicoius theme.  Manual cleanup to remove students from the class is required.\n\n          This module was tested against Moodle version 3.9",
  "references": [
    "CVE-2020-14321",
    "URL-https://moodle.org/mod/forum/discuss.php?d=407393",
    "URL-https://github.com/HoangKien1020/CVE-2020-14321",
    "EDB-50180"
  ],
  "platform": "PHP",
  "arch": "php",
  "rport": 80,
  "autofilter_ports": [
    80,
    8080,
    443,
    8000,
    8888,
    8880,
    8008,
    3000,
    8443
  ],
  "autofilter_services": [
    "http",
    "https"
  ],
  "targets": [
    "Automatic"
  ],
  "mod_time": "2021-10-11 16:23:09 +0000",
  "path": "/modules/exploits/multi/http/moodle_teacher_enrollment_priv_esc_to_rce.rb",
  "is_install_path": true,
  "ref_name": "multi/http/moodle_teacher_enrollment_priv_esc_to_rce",
  "check": true,
  "post_auth": true,
  "notes": {
    "Reliability": [
      "repeatable-session"
    ],
    "SideEffects": [
      "config-changes",
      "ioc-in-logs"
    ],
    "Stability": [
      "crash-safe"
    ]
  }
}
