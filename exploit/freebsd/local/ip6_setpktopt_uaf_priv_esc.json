{
	"name": "FreeBSD ip6_setpktopt Use-After-Free Privilege Escalation",
	"fullname": "exploit/freebsd/local/ip6_setpktopt_uaf_priv_esc",
	"rank": 500,
	"disclosure_date": "2020-07-07",
	"type": "exploit",
	"author": [
		"Andy Nguyen",
		"bcoles <bcoles@gmail.com>"
	],
	"description": "This module exploits a race and use-after-free vulnerability in the\n          FreeBSD kernel IPv6 socket handling. A missing synchronization lock\n          in the `IPV6_2292PKTOPTIONS` option handling in `setsockopt` permits\n          racing `ip6_setpktopt` access to a freed `ip6_pktopts` struct.\n\n          This exploit overwrites the `ip6po_pktinfo` pointer of a `ip6_pktopts`\n          struct in freed memory to achieve arbitrary kernel read/write.\n\n          This module has been tested successfully on:\n\n          FreeBSD 9.0-RELEASE #0 (amd64);\n          FreeBSD 9.1-RELEASE #0 r243825 (amd64);\n          FreeBSD 9.2-RELEASE #0 r255898 (amd64);\n          FreeBSD 9.3-RELEASE #0 r268512 (amd64);\n          FreeBSD 12.0-RELEASE r341666 (amd64); and\n          FreeBSD 12.1-RELEASE r354233 (amd64).",
	"references": [
		"CVE-2020-7457",
		"EDB-48644",
		"PACKETSTORM-158341",
		"URL-https://hackerone.com/reports/826026",
		"URL-https://bsdsec.net/articles/freebsd-announce-freebsd-security-advisory-freebsd-sa-20-20-ipv6",
		"URL-https://www.freebsd.org/security/patches/SA-20:20/ipv6.patch",
		"URL-https://github.com/freebsd/freebsd/blob/master/sys/netinet6/ip6_var.h",
		"URL-https://github.com/freebsd/freebsd/blob/master/sys/netinet6/ip6_output.c"
	],
	"platform": "BSD",
	"arch": "x64",
	"targets": [
		"Automatic",
		"FreeBSD 9.0-RELEASE #0",
		"FreeBSD 9.1-RELEASE #0 r243825",
		"FreeBSD 9.2-RELEASE #0 r255898",
		"FreeBSD 9.3-RELEASE #0 r268512",
		"FreeBSD 12.0-RELEASE r341666",
		"FreeBSD 12.1-RELEASE r354233"
	],
	"mod_time": "2023-02-02 18:45:43 +0000",
	"path": "/modules/exploits/freebsd/local/ip6_setpktopt_uaf_priv_esc.rb",
	"is_install_path": true,
	"ref_name": "freebsd/local/ip6_setpktopt_uaf_priv_esc",
	"check": true,
	"notes": {
		"Reliability": [
			"repeatable-session"
		],
		"SideEffects": [
			"artifacts-on-disk",
			"ioc-in-logs"
		],
		"Stability": [
			"crash-os-restarts"
		]
	},
	"session_types": [
		"shell"
	],
	"needs_cleanup": true
}
