{
	"name": "Microsoft Exchange Server DlpUtils AddTenantDlpPolicy RCE",
	"fullname": "exploit/windows/http/exchange_ecp_dlp_policy",
	"rank": 600,
	"disclosure_date": "2021-01-12",
	"type": "exploit",
	"author": [
		"Leonard Rapp",
		"Markus Vervier",
		"Steven Seeley",
		"Yasar Klawohn",
		"wvu <wvu@metasploit.com>",
		"Spencer McIntyre"
	],
	"description": "This vulnerability allows remote attackers to execute arbitrary code\n          on affected installations of Exchange Server. Authentication is\n          required to exploit this vulnerability. Additionally, the target user\n          must have the \"Data Loss Prevention\" role assigned and an active\n          mailbox.\n\n          If the user is in the \"Compliance Management\" or greater \"Organization\n          Management\" role groups, then they have the \"Data Loss Prevention\"\n          role. Since the user who installed Exchange is in the \"Organization\n          Management\" role group, they transitively have the \"Data Loss\n          Prevention\" role.\n\n          The specific flaw exists within the processing of the New-DlpPolicy\n          cmdlet. The issue results from the lack of proper validation of\n          user-supplied template data when creating a DLP policy. An attacker\n          can leverage this vulnerability to execute code in the context of\n          SYSTEM.\n\n          Tested against Exchange Server 2016 CU19 on Windows Server 2016.",
	"references": [
		"CVE-2020-16875",
		"CVE-2020-17132",
		"URL-https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2020-16875",
		"URL-https://support.microsoft.com/en-us/help/4577352/security-update-for-exchange-server-2019-and-2016",
		"URL-https://srcincite.io/advisories/src-2020-0019/",
		"URL-https://srcincite.io/pocs/cve-2020-16875.py.txt",
		"URL-https://srcincite.io/pocs/cve-2020-16875.ps1.txt",
		"URL-https://srcincite.io/blog/2021/01/12/making-clouds-rain-rce-in-office-365.html",
		"URL-https://www.x41-dsec.de/security/advisory/exploit/research/2020/12/21/x41-microsoft-exchange-rce-dlp-bypass/"
	],
	"platform": "Windows",
	"arch": "x86, x64",
	"rport": 443,
	"autofilter_ports": [
		80,
		8080,
		443,
		8000,
		8888,
		8880,
		8008,
		3000,
		8443
	],
	"autofilter_services": [
		"http",
		"https"
	],
	"targets": [
		"Exchange Server <= 2016 CU19 and 2019 CU8"
	],
	"mod_time": "2021-04-29 21:26:02 +0000",
	"path": "/modules/exploits/windows/http/exchange_ecp_dlp_policy.rb",
	"is_install_path": true,
	"ref_name": "windows/http/exchange_ecp_dlp_policy",
	"check": true,
	"post_auth": true,
	"notes": {
		"Reliability": [
			"repeatable-session"
		],
		"SideEffects": [
			"ioc-in-logs",
			"account-lockouts",
			"config-changes",
			"artifacts-on-disk"
		],
		"Stability": [
			"crash-safe"
		]
	}
}
