{
  "name": "Win32k NtGdiResetDC Use After Free Local Privilege Elevation",
  "fullname": "exploit/windows/local/cve_2021_40449",
  "rank": 400,
  "disclosure_date": "2021-10-12",
  "type": "exploit",
  "author": [
    "IronHusky",
    "Costin Raiu",
    "Boris Larin",
    "Red Raindrop Team of Qi'anxin Threat Intelligence Center",
    "KaLendsi",
    "ly4k",
    "Grant Willcox"
  ],
  "description": "A use after free vulnerability exists in the `NtGdiResetDC()` function of Win32k which can be leveraged by\n            an attacker to escalate privileges to those of `NT AUTHORITY\\SYSTEM`. The flaw exists due to the fact\n            that this function calls `hdcOpenDCW()`, which performs a user mode callback. During this callback, attackers\n            can call the `NtGdiResetDC()` function again with the same handle as before, which will result in the PDC object\n            that is referenced by this handle being freed. The attacker can then replace the memory referenced by the handle\n            with their own object, before passing execution back to the original `NtGdiResetDC()` call, which will now use the\n            attacker's object without appropriate validation. This can then allow the attacker to manipulate the state of the\n            kernel and, together with additional exploitation techniques, gain code execution as NT AUTHORITY\\SYSTEM.\n\n            This module has been tested to work on Windows 10 x64 RS1 (build 14393) and RS5 (build 17763), however previous versions\n            of Windows 10 will likely also work.",
  "references": [
    "CVE-2021-40449",
    "URL-https://securelist.com/mysterysnail-attacks-with-windows-zero-day/104509/",
    "URL-https://mp.weixin.qq.com/s/AcFS0Yn9SDuYxFnzbBqhkQ",
    "URL-https://github.com/KaLendsi/CVE-2021-40449-Exploit",
    "URL-https://github.com/ly4k/CallbackHell"
  ],
  "platform": "Windows",
  "arch": "x64",
  "targets": [
    "Windows 10 x64 RS1 (build 14393) and RS5 (build 17763)"
  ],
  "mod_time": "2023-06-16 08:32:41 +0000",
  "path": "/modules/exploits/windows/local/cve_2021_40449.rb",
  "is_install_path": true,
  "ref_name": "windows/local/cve_2021_40449",
  "check": true,
  "notes": {
    "Reliability": [
      "repeatable-session"
    ],
    "Stability": [
      "crash-os-restarts"
    ]
  },
  "session_types": [
    "meterpreter"
  ]
}
