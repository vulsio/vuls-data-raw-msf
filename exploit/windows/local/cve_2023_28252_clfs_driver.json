{
	"name": "Windows Common Log File System Driver (clfs.sys) Elevation of Privilege Vulnerability",
	"fullname": "exploit/windows/local/cve_2023_28252_clfs_driver",
	"rank": 400,
	"disclosure_date": "2023-04-11",
	"type": "exploit",
	"author": [
		"Ricardo Narvaja",
		"Esteban.kazimirow",
		"jheysel-r7"
	],
	"description": "A privilege escalation vulnerability exists in the clfs.sys driver which comes installed by default on\n            Windows 10 21H2, Windows 11 21H2 and Windows Server 20348 operating systems.\n\n            The clfs.sys driver contains a function CreateLogFile that is used to create\n            open and edit '*.blf' (base log format) files. Inside a .blf file there are multiple blocks of data which\n            contain checksums to verify the integrity of the .blf file and to ensure the file looks and acts like a\n            .blf file. However, these files can be edited with CreateFileA or with fopen and then modified with\n            WriteFile or fwrite respectively in order to change the contents of the file and update their checksums accordingly.\n\n            This exploit makes use to two different kinds of specially crafted .blf files that are edited using the technique\n            mentioned above. There are multiple spray .blf files. The spray .blf files are specially crafted to initiate an out of\n            bounds read which reads from a contiguous block of memory. The block of memory it reads from contains a read-write pipe\n            that points to the address of the second type of .blf file - the trigger .blf file. The trigger .blf file is specially\n            crafted read the SYSTEM token and write it in the process of the exploit to achieve the local privilege escalation.\n\n            The exploits creates a controlled memory space by first looping over the CreatePipe function to\n            to create thousands of read-write pipes (which take up 0x90 bytes of memory). It then releases a certain number of\n            pipes from memory and calls CreateLogFile to open the pre-existing spray .blf files which when being opened fill the\n            0x90 byte gaps created by the deallocation of the pipes in memory, creating the controlled memory space.\n\n            This is a very brief and high overview description of what the exploit is actually doing. For a more detailed and in\n            depth analysis please refer to the following [reference](https://github.com/fortra/CVE-2023-28252).",
	"references": [
		"CVE-2023-28252",
		"URL-https://github.com/fortra/CVE-2023-28252"
	],
	"platform": "Windows",
	"arch": "x64",
	"targets": [
		"Windows x64"
	],
	"mod_time": "2023-09-11 13:10:57 +0000",
	"path": "/modules/exploits/windows/local/cve_2023_28252_clfs_driver.rb",
	"is_install_path": true,
	"ref_name": "windows/local/cve_2023_28252_clfs_driver",
	"check": true,
	"notes": {
		"Reliability": [
			"unreliable-session"
		],
		"Stability": [
			"crash-safe"
		]
	},
	"session_types": [
		"meterpreter"
	]
}
