{
  "name": "MS15-001 Microsoft Windows NtApphelpCacheControl Improper Authorization Check",
  "fullname": "exploit/windows/local/ntapphelpcachecontrol",
  "rank": 300,
  "disclosure_date": "2014-09-30",
  "type": "exploit",
  "author": [
    "James Forshaw",
    "sinn3r <sinn3r@metasploit.com>"
  ],
  "description": "On Windows, the system call NtApphelpCacheControl (the code is actually in ahcache.sys)\n            allows application compatibility data to be cached for quick reuse when new processes are\n            created. A normal user can query the cache but cannot add new cached entries as the\n            operation is restricted to administrators. This is checked in the function\n            AhcVerifyAdminContext.\n\n            This function has a vulnerability where it doesn't correctly check the impersonation token\n            of the caller to determine if the user is an administrator. It reads the caller's\n            impersonation token using PsReferenceImpersonationToken and then does a comparison between\n            the user SID in the token to LocalSystem's SID. It doesn't check the impersonation level\n            of the token so it's possible to get an identify token on your thread from a local system\n            process and bypass this check.\n\n            This module currently only affects Windows 8 and Windows 8.1, and requires access to\n            C:\\Windows\\System\\ComputerDefaults.exe (although this can be improved).",
  "references": [
    "MSB-MS15-001",
    "CVE-2015-0002",
    "OSVDB-116497",
    "EDB-35661",
    "URL-https://code.google.com/p/google-security-research/issues/detail?id=118"
  ],
  "platform": "Windows",
  "arch": "x86, x64",
  "targets": [
    "Windows 8 / Windows 8.1 (x86 and x64)"
  ],
  "mod_time": "2023-05-25 12:45:30 +0000",
  "path": "/modules/exploits/windows/local/ntapphelpcachecontrol.rb",
  "is_install_path": true,
  "ref_name": "windows/local/ntapphelpcachecontrol",
  "check": true,
  "session_types": [
    "meterpreter"
  ]
}
