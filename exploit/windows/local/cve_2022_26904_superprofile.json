{
	"name": "User Profile Arbitrary Junction Creation Local Privilege Elevation",
	"fullname": "exploit/windows/local/cve_2022_26904_superprofile",
	"rank": 600,
	"disclosure_date": "2022-03-17",
	"type": "exploit",
	"author": [
		"KLINIX5",
		"Grant Willcox"
	],
	"description": "The user profile service, identified as ProfSrv, is vulnerable to a local privilege elevation vulnerability\n            in its CreateDirectoryJunction() function due to a lack of appropriate checks on the directory structure of\n            the junctions it tries to link together.\n\n            Attackers can leverage this vulnerability to plant a malicious DLL in a system directory and then trigger a\n            UAC prompt to cause this DLL to be loaded and executed by ProfSrv as the NT AUTHORITY\\SYSTEM user.\n\n            Note that this bug was originally identified as CVE-2021-34484 and was subsequently patched a second time as\n            CVE-2022-21919, however both patches were found to be insufficient. This bug is a patch bypass for\n            CVE-2022-21919 and at the time of publishing, has not yet been patched, though plans are in place to patch it\n            as CVE-2022-26904.\n\n            It is important to note that the credentials supplied for the second user to log in as in this exploit must be\n            those of a normal non-admin user and these credentials must also corralate with a user who has already logged in\n            at least once before. Additionally the current user running the exploit must have UAC set to the highest level,\n            aka \"Always Notify Me When\", in order for the code to be executed as NT AUTHORITY\\SYSTEM. Note however that\n            \"Always Notify Me When\" is the default UAC setting on common Windows installs, so this would only affect instances\n            where this setting has been changed either manually or as part of the installation process.",
	"references": [
		"CVE-2022-26904",
		"URL-https://github.com/rmusser01/SuperProfile",
		"URL-https://web.archive.org/web/20220222105232/https://halove23.blogspot.com/2022/02/blog-post.html",
		"URL-https://github.com/klinix5/ProfSvcLPE/blob/main/write-up.docx"
	],
	"platform": "Windows",
	"arch": "x64",
	"targets": [
		"Windows 11"
	],
	"mod_time": "2024-02-07 11:30:42 +0000",
	"path": "/modules/exploits/windows/local/cve_2022_26904_superprofile.rb",
	"is_install_path": true,
	"ref_name": "windows/local/cve_2022_26904_superprofile",
	"check": true,
	"post_auth": true,
	"notes": {
		"Reliability": [
			"repeatable-session"
		],
		"SideEffects": [
			"artifacts-on-disk",
			"ioc-in-logs",
			"screen-effects",
			"audio-effects"
		],
		"Stability": [
			"crash-safe"
		]
	},
	"session_types": [
		"meterpreter"
	],
	"needs_cleanup": true
}
