{
	"name": "DnsAdmin ServerLevelPluginDll Feature Abuse Privilege Escalation",
	"fullname": "exploit/windows/local/dnsadmin_serverlevelplugindll",
	"rank": 300,
	"disclosure_date": "2017-05-08",
	"type": "exploit",
	"author": [
		"Shay Ber",
		"Imran E. Dawoodjee <imran@threathounds.com>"
	],
	"description": "This module exploits a feature in the DNS service of Windows Server. Users of the DnsAdmins group can set the\n          `ServerLevelPluginDll` value using dnscmd.exe to create a registry key at `HKLM\\SYSTEM\\CurrentControlSet\\Services\\DNS\\Parameters\\`\n          named `ServerLevelPluginDll` that can be made to point to an arbitrary DLL. After doing so, restarting the service\n          will load the DLL and cause it to execute, providing us with SYSTEM privileges. Increasing WfsDelay is recommended\n          when using a UNC path.\n\n          Users should note that if the DLLPath variable of this module is set to a UNC share that does not exist,\n          the DNS server on the target will not be able to restart. Similarly if a UNC share is not utilized, and\n          users instead opt to drop a file onto the disk of the target computer, and this gets picked up by Anti-Virus\n          after the timeout specified by `AVTIMEOUT` expires, its possible that the `ServerLevelPluginDll` value of the\n          `HKLM\\SYSTEM\\CurrentControlSet\\Services\\DNS\\Parameters\\` key on the target computer may point to an nonexistant DLL,\n          which will also prevent the DNS server from being able to restart. Users are advised to refer to the documentation for\n          this module for advice on how to resolve this issue should it occur.\n\n          This module has only been tested and confirmed to work on Windows Server 2019 Standard Edition, however it should work against any Windows\n          Server version up to and including Windows Server 2019.",
	"references": [
		"URL-https://medium.com/@esnesenon/feature-not-bug-dnsadmin-to-dc-compromise-in-one-line-a0f779b8dc83",
		"URL-https://adsecurity.org/?p=4064",
		"URL-http://www.labofapenetrationtester.com/2017/05/abusing-dnsadmins-privilege-for-escalation-in-active-directory.html"
	],
	"platform": "Windows",
	"targets": [
		"Automatic"
	],
	"mod_time": "2023-05-25 12:45:30 +0000",
	"path": "/modules/exploits/windows/local/dnsadmin_serverlevelplugindll.rb",
	"is_install_path": true,
	"ref_name": "windows/local/dnsadmin_serverlevelplugindll",
	"check": true,
	"notes": {
		"Reliability": [
			"repeatable-session"
		],
		"SideEffects": [
			"config-changes",
			"ioc-in-logs"
		],
		"Stability": [
			"crash-service-down"
		]
	},
	"session_types": [
		"meterpreter"
	],
	"needs_cleanup": true
}
