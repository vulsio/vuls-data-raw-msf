{
	"name": "SYSTEM token impersonation through NTLM bits authentication on missing WinRM Service.",
	"fullname": "exploit/windows/local/bits_ntlm_token_impersonation",
	"rank": 500,
	"disclosure_date": "2019-12-06",
	"type": "exploit",
	"author": [
		"Cassandre",
		"Andrea Pierini (decoder)",
		"Antonio Cocomazzi (splinter_code)",
		"Roberto (0xea31)"
	],
	"description": "This module exploit BITS behavior which tries to connect to the\n            local Windows Remote Management server (WinRM) every times it\n            starts. The module launches a fake WinRM server which listen on\n            port 5985 and triggers BITS. When BITS starts, it tries to\n            authenticate to the Rogue WinRM server, which allows to steal a\n            SYSTEM token. This token is then used to launch a new process\n            as SYSTEM user. In the case of this exploit, notepad.exe is launched\n            as SYSTEM. Then, it write shellcode in its previous memory space\n            and trigger its execution. As this exploit uses reflective dll\n            injection, it does not write any file on the disk. See\n            /documentation/modules/exploit/windows/local/bits_ntlm_token_impersonation.md\n            for complementary words of information.\n\n            Vulnerable operating systems are Windows 10 and Windows servers where WinRM is not running.\n            Lab experiments has shown that Windows 7 does not exhibit the vulnerable behavior.\n\n            WARNING:\n\n            - As this exploit runs a service on the target (Fake WinRM on port\n            5985), a firewall popup may appear on target screen. Thus, this exploit\n            may not be completely silent.\n\n            - This exploit has been successfully tested on :\n            Windows 10 (10.0 Build 19041) 32 bits\n            Windows 10 Pro, Version 1903 (10.0 Build 18362) 64 bits\n\n            - This exploit failed because of no BITS authentication attempt on:\n            Windows 7 (6.1 Build 7601, Service Pack 1) 32 bits\n\n            - Windows servers are not vulnerable because a genuine WinRM\n            service is already running, except if the user has disabled it\n            (Or if this exploit succeed to terminate it).\n\n            - SE_IMPERSONATE_NAME or SE_ASSIGNPRIMARYTOKEN_NAME privs are\n            required.\n\n            - BITS must not be running.\n\n            - This exploit automatically perform above quoted checks.\n            run \"check\" command to run checklist.",
	"references": [
		"URL-https://decoder.cloud/2019/12/06/we-thought-they-were-potatoes-but-they-were-beans/",
		"URL-https://github.com/antonioCoco/RogueWinRM"
	],
	"platform": "Windows",
	"arch": "x86, x64",
	"targets": [
		"Automatic"
	],
	"mod_time": "2023-05-25 12:45:30 +0000",
	"path": "/modules/exploits/windows/local/bits_ntlm_token_impersonation.rb",
	"is_install_path": true,
	"ref_name": "windows/local/bits_ntlm_token_impersonation",
	"check": true,
	"notes": {
		"Reliability": [
			"repeatable-session"
		],
		"SideEffects": [
			"screen-effects"
		],
		"Stability": [
			"crash-safe"
		]
	},
	"session_types": [
		"meterpreter"
	]
}
